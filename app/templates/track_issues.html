{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <h2>All Issues</h2>

  <table class="table table-bordered">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Description</th>
        <th>Priority</th>
        <th>Status</th>
        <th>Assigned To</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for issue in issues %}
      <tr>
        <td>{{ issue._id }}</td>
        <td>{{ issue.title }}</td>
        <td>{{ issue.description }}</td>
        <td>{{ issue.priority }}</td>
        <td>{{ issue.status }}</td>
        <td>{{ issue.assigned_to }}</td>
        <td>
          <!-- Edit Button -->
          <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#editModal{{ issue._id }}">Edit</button>

          <!-- Delete Form -->
          <form method="POST" action="{{ url_for('main.delete_issue', issue_id=issue._id) }}" style="display:inline;">
            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
          </form>

          <!-- View History -->
          <a href="{{ url_for('main.issue_history', issue_title=issue.title) }}" class="btn btn-sm btn-info">History</a>
        </td>
      </tr>

      <!-- Edit Modal -->
      <div class="modal fade" id="editModal{{ issue._id }}" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <form method="POST" action="{{ url_for('main.update_issue', issue_id=issue._id) }}">
              <div class="modal-header">
                <h5 class="modal-title">Edit Issue</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label class="form-label">Status</label>
                  <select class="form-select" name="status">
                    <option value="Open" {% if issue.status == 'Open' %}selected{% endif %}>Open</option>
                    <option value="In Progress" {% if issue.status == 'In Progress' %}selected{% endif %}>In Progress</option>
                    <option value="Resolved" {% if issue.status == 'Resolved' %}selected{% endif %}>Resolved</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Priority</label>
                  <select class="form-select" name="priority">
                    <option value="Low" {% if issue.priority == 'Low' %}selected{% endif %}>Low</option>
                    <option value="Medium" {% if issue.priority == 'Medium' %}selected{% endif %}>Medium</option>
                    <option value="High" {% if issue.priority == 'High' %}selected{% endif %}>High</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Assigned To</label>
                  <input type="text" class="form-control" name="assigned_to" value="{{ issue.assigned_to }}">
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-success">Save</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}
    </tbody>
  </table>

  <!-- Pagination -->
  <nav aria-label="Page navigation">
    <ul class="pagination">
      {% if has_prev %}
      <li class="page-item">
        <a class="page-link" href="{{ url_for('main.track_issues', page=page-1) }}">Previous</a>
      </li>
      {% endif %}
      {% if has_next %}
      <li class="page-item">
        <a class="page-link" href="{{ url_for('main.track_issues', page=page+1) }}">Next</a>
      </li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endblock %}
